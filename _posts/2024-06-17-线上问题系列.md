---
layout: post
title: "线上问题"
description: ""
category: [java,线上问题]
tags: [线上问题]
---
{% include JB/setup %}

### CPU飙高
* top查所有进程占用CPU的排序
* top -Hp 进程号，找到进程下线程占用CPU的情况，找到占用CPU最高的线程编号
* 执行print %x 线程号，转换成16进制，因为线程堆栈都是16进制数字
* 执行jstack 进程号|grep 线程号，查看线程堆栈信息，找到具体代码

### Arthas

### 线上OOM
* 简介：请求进来，创建对象，去内存里面申请空间，内存满了，触发full gc，gc之后内存依然爆满，OOM
* 影响
  * 新请求不需要申请堆内存空间，正常用
  * 新请求需要申请堆内存空间，进程飙高，操作系统认为危险，杀进程，服务宕机
* 解决
  * 已经OOM宕机了，直接看dump文件，用jvm那个自带的工具分析下对象找到gcRoot，之后找到线程栈，之后找到问题
  * 没有OOM宕机，如果执行jmap导出dump，会进行gc，会stop the world，很危险，所以最好用arthas