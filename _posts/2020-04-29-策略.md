---
layout: post
title: "java"
description: "java"
category: [java]
tags: [策略]
---
{% include JB/setup %}



```
public interface CandidateRegisterProcessor {

    /**
     * 责任链的检查顺序，小的在前面，default必须在最后
     */
    int REGISTER_PROCESS_PRIORITY_COSMETOLOGY = 0;
    int REGISTER_PROCESS_PRIORITY_MULTIPLE = 1;//多参数候补
    int REGISTER_PROCESS_PRIORITY_DEFAULT = Integer.MAX_VALUE;

    int getPriority();

    boolean match(CandidateRegisterContext context);

    CandidateRegisterResult register(CandidateRegisterContext context);
}
```

```
@Service
public class CandidateMultipleRegisterProcessor extends CandidateAbstractRegisterProcessor {
 @Override
    public int getPriority() {
        return CandidateRegisterProcessor.REGISTER_PROCESS_PRIORITY_MULTIPLE;
    }

    @Override
    public boolean match(CandidateRegisterContext context) {
        return true;
    }
    @Override
    protected CandidateRegisterResult doRegister(CandidateRegisterContext context) {
        return null;
    }
}
```

```
class A{
    @Resource
    private List<CandidateRegisterProcessor> candidateRegisterProcessors;

  
   CandidateRegisterResult result = CandidateRegisterHelper.processRegister(
                            new CandidateRegisterContext(order, request),
                            candidateRegisterProcessors);
}
```

```
public class CandidateRegisterHelper {

    private static void checkOrInitParam(CandidateRegisterContext context) {
        Preconditions.checkArgument(context.getOrder() != null, "order不能为空");
        Preconditions.checkArgument(context.getRequest() != null, "request不能为空");
    }

    private static void preHandleRegisterProcessors(List<CandidateRegisterProcessor> processors) {
        Safes.of(processors)
                .sort(Comparator.comparingInt(CandidateRegisterProcessor::getPriority));
    }

    public static CandidateRegisterResult processRegister(CandidateRegisterContext context, List<CandidateRegisterProcessor> processors) {
        checkOrInitParam(context);
        preHandleRegisterProcessors(processors);
        return Safes.of(processors).stream()
                .filter(processor -> processor.match(context))
                .findFirst()
                .orElseThrow(() -> new RuntimeException("[候补锁号]未找到匹配的Processor"))
                .register(context);
    }

}
```

