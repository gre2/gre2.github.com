---
layout: post
title: "mysql问答"
description: "mysql"
category: [java,mysql]
tags: [mysql]
---
{% include JB/setup %}

# mysql问答

#### 索引类型

1.聚集索引（一般是主键）：决定数据在磁盘上的物理排序，一个表只能有一个聚集索引

2.非聚集索引：索引上只包含被建立索引的数据，以及一个行定位符，这个行定位符，可以理解为一个聚集索引物理排序的指针，通过这个指针，可以找到行数据

3.覆盖索引：被查询的所有列都是索引，这时不用通过行定位符再到row上获取

#### 为什么需要主键（聚集索引）

innodb自增主键会把数据自动向后插入，避免了插入过程中的聚集索引的排序问题，聚集索引的排序，必然会带来大范围的数据的物理移动，带来磁盘io的性能损耗，如果聚集索引的值可以改变的话，那么也会发出物理磁盘上的移动，于是就可能出现磁盘页分裂（索引存储在磁盘上！！！），表碎片横生

#### MongoDb索引的数据结构   -   B-树

##### 1.索引为什么要树结构存储

树的查询效率高，而且有序

##### 2.为什么没有用二叉树呢

二叉树时间复杂度O(logN)，从算法逻辑来讲，查找速度和比较次数都是最小的，但是磁盘IO问题，数据库的索引存储在磁盘上，当数据量很大的时候，索引几个G，不可能把整个索引全部加载到内存，能做的只是逐一加载每一个磁盘页，这里的磁盘页对应索引树的节点。

![](https://ws1.sinaimg.cn/large/87a42753ly1fvlvftf330j20jx0e30uj.jpg)

二叉树的查找，4次磁盘IO，找到元素10

![](https://ws1.sinaimg.cn/large/87a42753ly1fvlvgx5m6rj20gp0bw41f.jpg)

为了减少磁盘IO，我们需要把瘦高的树，变的矮胖，这就是B-树的特征之一。

##### 3.B-树

**多路平衡查找树，它的每个节点最多包含k个孩子，k被称为B树的阶，k的大小取决于磁盘页的大小。**

特征：

1.根节点最少两个子女

2.每个中间节点都包含k-1个元素和k个孩子，m/2<=k<=m

3.每个叶子节点都包含k-1个元素，m/2<=k<=m

4.所有的叶子节点位于同一层

5.每个节点中的元素从小到大排列，节点当中k-1个元素正好是k个孩子包含的元素的至于分划

![](https://ws1.sinaimg.cn/large/87a42753ly1fvlvt44mkoj20is07xgn7.jpg)

在内存中定位，比较3,5，相比于磁盘IO的速度，内存耗时可以忽略不计

##### 4.B-树的卫星数据

![](https://ws1.sinaimg.cn/large/87a42753ly1fvm1bzgqk0j20it0bigos.jpg)

##### 5.B-树的新增   -  自平衡

![](https://ws1.sinaimg.cn/large/87a42753ly1fvm0w2uma1j20iy0np42z.jpg)

##### 6.B-树的删除

![](https://ws1.sinaimg.cn/large/87a42753ly1fvm0zq0bdij20jd0x0gsf.jpg)

#### Mysql索引数据结构

B+树是基于B-树的一种变体，有着比B-树更高的查询性能

##### B+树的特征

1.k阶b+树，中间节点包含k个元素（B-树是k-1个元素），每个元素不保存数据，只用来记录索引，所有数据都保存在叶子节点

2.所有叶子节点包含了全部的元素信息，及指向含这些元素记录的指针，且叶子节点本身依关键字的大小自小而大顺序连接

3.所有中间节点元素都同时存在于子节点，在子节点元素中是最大或最小元素

   **叶子节点形成了一个有序链表**

![](https://ws1.sinaimg.cn/large/87a42753ly1fvm18yl4guj20im07cjt3.jpg)

##### B+树的卫星数据

**在数据库的聚集索引中，叶子节点直接包含卫星数据，在非聚集索引中，叶子及诶单带有指向卫星数据的指针**

![](https://ws1.sinaimg.cn/large/87a42753ly1fvm1d3slqtj20iv0ao771.jpg)

##### B+树查询性能（单行查询  +  范围查询）之三个优势

在B+树中**单行查询**找3这个元素和B-树的不同体现在

1.B+树中间节点没有卫星数据，相同大小的磁盘页可以容纳更多的节点元素，IO次数更少

2.B+树查询必须找到叶子节点查询性能稳定

![](https://ws1.sinaimg.cn/large/87a42753ly1fvm1ff5calj20iy0ss7ae.jpg)



在B+树中**范围查询**找3到11的元素和B-树的不同体现在

1.B-树只能采用中序遍历的方法，B+树只需要在链表上做遍历即可



![](https://ws1.sinaimg.cn/large/87a42753ly1fvm1l3dqblj20he1c4aig.jpg)



![](https://ws1.sinaimg.cn/large/87a42753ly1fvm1mhjd48j20h20rewju.jpg)